<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aurevox Lens - Like Steroids, For Businesses.</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            position: relative;
            min-height: 100vh;
            overflow-x: hidden;
            color: white;
            width: 100vw;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('/static/polar-lights-5858656.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            filter: blur(2px);
            z-index: -2;
        }
        
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.4);
            z-index: -1;
        }
        
        .glass-panel {
            background: rgba(15, 23, 42, 0.5);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(148, 163, 184, 0.3);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #3b82f6, #1e40af, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .floating {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        .morphism-card {
            background: linear-gradient(145deg, rgba(15, 23, 42, 0.25), rgba(30, 41, 59, 0.15));
            backdrop-filter: blur(30px);
            border: 1px solid rgba(148, 163, 184, 0.3);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
        }
        
        .error-message {
            background: rgba(239, 68, 68, 0.9);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            border: 1px solid rgba(220, 38, 38, 0.3);
        }
        
        .success-message {
            background: rgba(34, 197, 94, 0.9);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            border: 1px solid rgba(22, 163, 74, 0.3);
        }
    </style>
</head>
<body class="min-h-screen w-screen overflow-x-hidden">
    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 glass-panel">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-xl flex items-center justify-center bg-transparent">
                        <span class="text-white font-bold text-lg">üîç</span>
                    </div>
                    <h1 class="text-2xl font-bold">
                        <span class="gradient-text">Aurevox</span>
                        <span class="text-white">Lens</span>
                    </h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="px-4 py-2 rounded-full text-white font-medium glass-panel">
                        Authentication Required
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="pt-24 pb-12 px-4 w-full">
        <div class="max-w-7xl mx-auto w-full">
            <!-- Hero Section -->
            <div class="text-center mb-8 floating">
                <h1 class="text-5xl md:text-7xl font-black mb-4">
                    <span class="gradient-text">Aurevox</span>
                    <span class="text-white">Lens</span>
                </h1>
                <p class="text-lg md:text-xl text-white/80 max-w-2xl mx-auto">
                    Fast. Smart. Effortless Lead Collection
                </p>
                <div class="mt-6 w-20 h-1 bg-gradient-to-r from-blue-500 to-purple-600 mx-auto rounded-full"></div>
            </div>

            <!-- API Key Section -->
            <div id="authSection" class="mb-8 w-full max-w-md mx-auto">
                <div class="morphism-card rounded-2xl p-6 w-full">
                    <div class="text-center mb-6">
                        <div class="w-14 h-14 mx-auto mb-3 bg-transparent rounded-xl flex items-center justify-center">
                            <span class="text-2xl">üîë</span>
                        </div>
                        <h2 class="text-2xl font-bold text-white mb-1">Access Portal</h2>
                        <p class="text-white/70">Enter your API key to begin</p>
                    </div>
                    
                    <!-- Error Message Display -->
                    {% if error_message %}
                    <div class="error-message">
                        <div class="flex items-center space-x-2">
                            <span>‚ùå</span>
                            <span>{{ error_message }}</span>
                        </div>
                    </div>
                    {% endif %}
                    
                    <div class="space-y-4">
                        <div>
                            <input 
                                id="apiKey" 
                                type="text"
                                placeholder="Enter your API key"
                                class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                            >
                        </div>
                        <button 
                            id="validateKey" 
                            class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white font-semibold py-3 px-6 rounded-xl hover:from-blue-600 hover:to-purple-700 transition-all"
                        >
                            <span class="flex items-center justify-center space-x-2">
                                <span>Authenticate</span>
                            </span>
                        </button>
                    </div>
                    
                    <!-- Info Section -->
                    <div class="mt-6 pt-6 border-t border-white/10">
                        <div class="text-center text-white/60 text-sm">
                            <p class="mb-2">Don't have an API key?</p>
                            <p class="text-xs">
                              <a href="https://hanafi3.gumroad.com/l/200-credits" 
                                 class="text-cyan-400 underline hover:text-cyan-300">
                                Get one now
                              </a>
                            </p>

                        </div>
                    </div>
                </div>
            </div>

            <!-- Features Section -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl mx-auto">
                <div class="morphism-card rounded-xl p-6 text-center">
                    <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center mx-auto mb-4">
                        <span class="text-xl">üéØ</span>
                    </div>
                    <h3 class="text-lg font-bold text-white mb-2">Targeted Search</h3>
                    <p class="text-white/70 text-sm">Find business contacts across multiple social platforms with precision targeting</p>
                </div>

                <div class="morphism-card rounded-xl p-6 text-center">
                    <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-teal-600 rounded-lg flex items-center justify-center mx-auto mb-4">
                        <span class="text-xl">‚ö°</span>
                    </div>
                    <h3 class="text-lg font-bold text-white mb-2">Lightning Fast</h3>
                    <p class="text-white/70 text-sm">Automated email collection with real-time results and instant downloads</p>
                </div>

                <div class="morphism-card rounded-xl p-6 text-center">
                    <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-600 rounded-lg flex items-center justify-center mx-auto mb-4">
                        <span class="text-xl">üìä</span>
                    </div>
                    <h3 class="text-lg font-bold text-white mb-2">Smart Analytics</h3>
                    <p class="text-white/70 text-sm">Advanced filtering and Facebook page lookup with detailed business insights</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize GSAP animations
        gsap.registerPlugin();
        
        // Global variables
        let socket = null;
        let currentUser = null;
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeEventListeners();
            initializeSocket();
            
            // Check for URL parameter error message
            {% if error_message %}
            showError("{{ error_message }}", 'error');
            {% endif %}
        });

        function initializeEventListeners() {
            // API Key validation
            document.getElementById('validateKey').addEventListener('click', validateApiKey);
            
            // Enter key for API validation
            document.getElementById('apiKey').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    validateApiKey();
                }
            });
        }

        function initializeSocket() {
            socket = io();
        }

        async function validateApiKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            
            if (!apiKey) {
                showError('Please enter an API key');
                return;
            }

            const button = document.getElementById('validateKey');
            button.disabled = true;
            button.innerHTML = '<span class="flex items-center justify-center space-x-2">Checking...</span>';

            try {
                const response = await fetch('/check_key', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ key: apiKey })
                });

                const result = await response.json();

                if (result.valid && !result.expired) {
                    currentUser = result;
                    // Redirect to collection page with key parameter
                    window.location.href = `/collection?key=${encodeURIComponent(apiKey)}`;
                } else if (result.expired) {
                    showError('API key has expired');
                } else {
                    showError(result.error || 'Invalid API key');
                }
            } catch (error) {
                console.error('Validation error:', error);
                showError('Connection error. Please try again.');
            }

            button.disabled = false;
            button.innerHTML = '<span class="flex items-center justify-center space-x-2">Authenticate</span>';
        }

        function showError(message, type = 'error') {
            const errorContainer = document.createElement('div');
            errorContainer.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm transition-all duration-300 ${
                type === 'error' ? 'bg-red-500/90' : 
                type === 'warning' ? 'bg-yellow-500/90' : 
                'bg-green-500/90'
            } text-white`;
            
            errorContainer.innerHTML = `
                <div class="flex items-center space-x-3">
                    <span class="text-xl">
                        ${type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚úÖ'}
                    </span>
                    <div class="flex-1">
                        <p class="font-medium">${message}</p>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="text-white/70 hover:text-white">
                        ‚úï
                    </button>
                </div>
            `;
            
            document.body.appendChild(errorContainer);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (errorContainer.parentNode) {
                    errorContainer.remove();
                }
            }, 5000);
        }

        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + Enter to validate key
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                validateApiKey();
            }
        });

        // Console logs for debugging
        console.log('üöÄ Aurevox Lens Authentication Page initialized successfully!');
        console.log('üí° Tips:');
        console.log('  ‚Ä¢ Use Ctrl/Cmd + Enter to quick authenticate');
        console.log('  ‚Ä¢ Direct access available via URL parameter: ?key=YOUR_API_KEY');
    </script>
</body>
</html>
